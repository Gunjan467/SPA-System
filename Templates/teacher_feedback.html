{% extends 'base.html' %}
{% block content %}
<style>
/* ---------- PAGE WRAPPER ---------- */
body{
    background:linear-gradient(135deg,#eef2ff,#fdf2f8);
}

/* ---------- COMMON CARD ---------- */
.card{
    background:#fff;
    border-radius:18px;
    padding:26px 30px;
    margin:14px auto;
    max-width:1200px;
    width:92%;
    box-shadow:0 14px 40px rgba(0,0,0,0.08);
}

/* ---------- COLOR VARIANTS ---------- */
.card.add{
    background:#f0fdf4; /* light green */
}
.card.filter{
    background:#eff6ff; /* light blue */
}
.card.table{
    background:#ffffff;
}

/* ---------- HEADINGS ---------- */
.card h4{
    margin-bottom:20px;
    font-size:22px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:10px;
}

/* ---------- FORMS ---------- */
.form-row{
    display:flex;
    gap:16px;
    flex-wrap:wrap;
    align-items:center;
}

.form-row input,
.form-row textarea{
    padding:12px 16px;
    border-radius:12px;
    border:1px solid #d1d5db;
    font-size:14px;
}

.form-row input{
    width:200px;
}

.form-row textarea{
    width:420px;
    resize:none;
    height:50px;
}

/* ---------- BUTTONS ---------- */
.btn-add{
    background:#22c55e;
    color:#fff;
    border:none;
    padding:12px 22px;
    border-radius:12px;
    font-weight:500;
    cursor:pointer;
}

.btn-filter{
    background:#3b82f6;
    color:#fff;
    border:none;
    padding:12px 22px;
    border-radius:12px;
    font-weight:500;
    cursor:pointer;
}

.btn-update{
    background:#fb923c;
    color:#fff;
    border:none;
    padding:8px 18px;
    border-radius:12px;
    cursor:pointer;
}

.btn-delete{
    background:#fee2e2;
    color:#dc2626;
    border:none;
    padding:8px 18px;
    border-radius:12px;
    cursor:pointer;
}

/* ---------- TABLE ---------- */
table{
    width:100%;
    border-collapse:separate;
    border-spacing:0 8px; /* fixes compact look */
    table-layout:fixed;
}

thead tr{
    background:#f3f4f6;
}

th{
    padding:14px;
    text-align:left;
    font-weight:600;
}

tbody tr{
    background:#ffffff;
    box-shadow:0 4px 12px rgba(0,0,0,0.04);
    border-radius:12px;
}

td{
    padding:8px 12px;          /* smaller row height */
    vertical-align:middle;     /* align text nicely */
    font-size:16px;
    line-height:1.3;
}

/* Feedback column wider */
td:nth-child(4){
    width:38%;
}

/* ---------- BACK BUTTON ---------- */
.back-btn{
    display:inline-block;
    margin-top:24px;
    background:#6b7280;
    color:#fff;
    padding:12px 22px;
    border-radius:25px;
    text-decoration:none;
    font-weight:500;
}

/* ---------- FLASH ---------- */
.flash-msg{
    max-width:1200px;
    width:92%;
    margin:18px auto;
    padding:14px;
    border-radius:12px;
}
.flash-msg.success{
    background:#dcfce7;
    color:#166534;
}
.flash-msg.error{
    background:#fee2e2;
    color:#991b1b;
}
/* ---------- BUTTON HOVER ---------- */
.btn-add:hover{
    background:#16a34a;
}

.btn-filter:hover{
    background:#2563eb;
}

.btn-update:hover{
    background:#f97316;
}

.btn-delete:hover{
    background:#fecaca;
    color:#b91c1c;
}

.back-btn:hover{
    background:#4b5563;
}

</style>

<!-- FLASH -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% for c,m in messages %}
<div class="flash-msg {{ c }}">{{ m }}</div>
{% endfor %}
{% endwith %}

<!-- ADD -->
<div class="card add">
<h4>‚ûï Add Feedback</h4>
<form method="POST" class="form-row">
<input type="hidden" name="mode" value="add">
<input name="roll_no" placeholder="Roll No" required>
<input name="subject" placeholder="Subject" required>
<textarea name="feedback" placeholder="Feedback" required></textarea>
<button class="btn-add">Add</button>
</form>
</div>

<!-- FILTER -->
<div class="card filter">
<h4>üîç Filter Feedback</h4>
<form method="GET" class="form-row">
<input name="search" placeholder="Roll No or Name">
<input name="subject" placeholder="Subject">
<button class="btn-filter">Filter</button>
</form>
</div>

<!-- TABLE -->
<div class="card">
<h4>üìã Feedback Records</h4>
<table>
<thead>
<tr>
<th>Roll No</th>
<th>Name</th>
<th>Subject</th>
<th>Feedback</th>
<th>Teacher</th>
<th>Date</th>
<th>Edit</th>
<th>Remove</th>
</tr>
</thead>

<tbody>
{% for f in feedbacks %}
<tr>
<td>{{ f[1] }}</td>
<td>{{ f[2] }}</td>
<td>{{ f[3] }}</td>
<td class="feedback-text">{{ f[4] }}</td>
<td>{{ f[5] }}</td>
<td>{{ f[6].strftime('%d-%m-%Y') }}</td>

<td>
<button class="btn-update"
onclick="editFeedback('{{ f[0] }}', this)">
Edit
</button>

<span class="hidden-feedback" style="display:none;">
{{ f[4] }}
</span>
</td>
<td>
<form method="POST">
<input type="hidden" name="mode" value="delete">
<input type="hidden" name="feedback_id" value="{{ f[0] }}">
<button class="btn-delete"
onclick="return confirm('Delete this feedback?')">
Delete
</button>
</form>
</td>
</tr>
{% endfor %}
</tbody>
</table>

<div style="margin-top:20px;">
    <a href="/teacher-dashboard" class="back-btn">
        ‚Üê Back to Dashboard
    </a>
</div>
</div>
<script>
function editFeedback(id, btn) {
    const text = btn.nextElementSibling.innerText;
    const t = prompt("Edit feedback:", text);
    if (!t) return;

    const f = document.createElement("form");
    f.method = "POST";
    f.innerHTML = `
        <input type="hidden" name="mode" value="update">
        <input type="hidden" name="feedback_id" value="${id}">
        <input type="hidden" name="feedback" value="${t}">
    `;
    document.body.appendChild(f);
    f.submit();
}
</script>

{% endblock %}
